<!DOCTYPE html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.2/d3.min.js"
    integrity="sha512-oKI0pS1ut+mxQZdqnD3w9fqArLyILRsT3Dx0B+8RVEXzEk3aNK3J3pWlaGJ8MtTs1oiwyXDAH6hG6jy1sY0YqA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <svg style="height: 100vh; width: 100vw;">
    <g class="out-container">
      <g class="container"></g>
    </g>
  </svg>
  <div style="position: fixed; font-size: 5vh; top: 5vh; left: 5vh; ;" class="label">label</div>
  <script>
    async function main() {
      const chinaData = await d3.json('./china.geojson');
      const koreaData = await d3.json('./korea.json');
      const projection = d3.geoMercator().fitSize([1000, 1000], chinaData);
      const path = d3.geoPath(projection);
      const container = d3.select(".container");
      const outCountainer = d3.select(".out-container");
      const zoom = d3.zoom()
        .scaleExtent([1, 8])
        .on("zoom", (e) => {
          container.attr("transform", e.transform);
        })
        .extent([[0, 0], [1000, 1000]]);
      outCountainer.call(zoom);
      container.selectAll('path.cn').data(chinaData.features).join('path').attr("d", path).attr("fill", "red").attr("stroke", "black");
      container.selectAll('path.ko').data(koreaData.features).join('path').attr("d", path).attr("fill", "blue").attr("stroke", "black");
      container.selectAll('circle.cn').data([].concat(...(chinaData.features.map(d => d.geometry.coordinates[0])))).join('circle').attr("cx", d => projection(d)[0]).attr("cy", d => projection(d)[1]).attr("r", 2).attr("fill", "red").attr("stroke", "black").on("mouseenter", (e, d) => {
        d3.select(".label").text(d);
      });
      const koreaPoints = [].concat(...(koreaData.features.map(d => {
        if (d.geometry.type === 'Polygon') {
          return d.geometry.coordinates[0];
        }
        else if (d.geometry.type === 'MultiPolygon') {
          return [].concat(...d.geometry.coordinates.map(d => d[0]));
        }
        else {
          console.log(d.geometry);
        }
      }
      )));
      console.log(koreaData, koreaPoints);
      container.selectAll('circle.ko').data(koreaPoints).join('circle').attr("cx", d => projection(d)[0]).attr("cy", d => projection(d)[1]).attr("r", 2).attr("fill", "blue").attr("stroke", "black").on("mouseenter", (e, d) => {
        d3.select(".label").text(d);
      });
    }

    main();
    
  </script>
</body>